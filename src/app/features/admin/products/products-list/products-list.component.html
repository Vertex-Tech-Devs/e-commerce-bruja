<div class="container-fluid my-4">
  <div class="card product-list-card shadow-sm">
    <div class="card-body">
      <h2 class="card-title text-center mb-4">Lista de Productos</h2>

      <div class="row g-3 mb-4 align-items-center">
        <div class="col-lg-6 col-md-12">
          <input
            type="text"
            class="form-control"
            placeholder="Buscar por nombre, descripción o categoría..."
            [ngModel]="searchTermSubject.value"
            (ngModelChange)="onSearchChange($event)"
          />
        </div>
        <div class="col-lg-3 col-md-6">
          <select
            class="form-select"
            [ngModel]="filterCategorySubject.value"
            (ngModelChange)="onFilterCategoryChange($event)"
          >
            <option value="all">Todas las Categorías</option>
            <option
              *ngFor="let category of categoryOptions.slice(1)"
              [value]="category"
            >
              {{ category | titlecase }}
            </option>
          </select>
        </div>
        <div class="col-lg-3 col-md-6">
          <select
            class="form-select"
            [ngModel]="itemsPerPageSubject.value"
            (ngModelChange)="onItemsPerPageChange($event)"
          >
            <option *ngFor="let option of itemsPerPageOptions" [value]="option">
              {{ option }} por página
            </option>
          </select>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-hover align-middle product-table">
          <thead>
            <tr>
              <th scope="col" class="col-nombre">Nombre</th>
              <th scope="col" class="col-descripcion">Descripción</th>
              <th scope="col" class="text-end col-precio">Precio</th>
              <th scope="col" class="col-categoria">Categoría</th>
              <th scope="col" class="text-center col-stock">Stock</th>
              <th scope="col" class="text-center col-acciones">Acciones</th>
            </tr>
          </thead>
          <tbody *ngIf="products$ | async as products; else loading">
            <tr *ngIf="products.length === 0">
              <td colspan="6" class="text-center text-muted-custom py-5">
                <div *ngIf="searchTermSubject.value || filterCategorySubject.value !== 'all'; else noProducts">
                    <i class="bi bi-search fs-2 d-block mb-2"></i>
                    No se encontraron productos que coincidan.
                </div>
                <ng-template #noProducts>
                    <i class="bi bi-box2-heart fs-2 d-block mb-2"></i>
                    Aún no hay productos para mostrar.
                </ng-template>
              </td>
            </tr>
            <tr *ngFor="let product of products">
              <td data-label="Nombre" class="col-nombre">{{ product.name }}</td>
              <td data-label="Descripción" class="col-descripcion">{{ product.description }}</td>
              <td data-label="Precio" class="text-end col-precio">
                {{ product.price | currency : "ARS" : "$" }}
              </td>
              <td data-label="Categoría" class="col-categoria">{{ product.category | titlecase }}</td>
              <td data-label="Stock" class="text-center col-stock">
                <span class="badge" [ngClass]="{
                  'bg-success': product.stock > 10,
                  'bg-warning': product.stock > 0 && product.stock <= 10,
                  'bg-danger': product.stock === 0
                }">
                  {{ product.stock }}
                </span>
              </td>
              <td data-label="Acciones" class="text-center col-acciones">
                <a [routerLink]="['/admin/products/edit', product.id]" class="btn btn-outline-primary btn-sm me-2" title="Editar">
                    <i class="bi bi-pencil-square"></i>
                </a>
                <button
                  class="btn btn-outline-danger btn-sm"
                  (click)="confirmDelete(product)"
                  title="Eliminar"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <ng-template #loading>
            <tbody>
              <tr>
                <td colspan="6" class="text-center py-5">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando productos...</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </ng-template>
        </table>
      </div>

      <div *ngIf="totalProducts > 0" class="d-flex justify-content-center mt-4">
        <nav aria-label="Paginación de productos">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPageSubject.value === 1">
              <a class="page-link" (click)="goToPage(1)" aria-label="Primera">&laquo;</a>
            </li>
            <li class="page-item" [class.disabled]="currentPageSubject.value === 1">
              <a class="page-link" (click)="goToPage(currentPageSubject.value - 1)" aria-label="Anterior">&lsaquo;</a>
            </li>
            <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="currentPageSubject.value === i + 1">
              <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="currentPageSubject.value === totalPages">
              <a class="page-link" (click)="goToPage(currentPageSubject.value + 1)" aria-label="Siguiente">&rsaquo;</a>
            </li>
            <li class="page-item" [class.disabled]="currentPageSubject.value === totalPages">
              <a class="page-link" (click)="goToPage(totalPages)" aria-label="Última">&raquo;</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<a routerLink="/admin/products/create" class="btn btn-primary btn-lg rounded-circle fab-button shadow-lg" title="Nuevo Producto">
  <i class="bi bi-plus-lg"></i>
</a>

